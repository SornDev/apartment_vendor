import{m as L}from"./ulmixins-6Aw97T0R.js";import{_ as P,c,a as t,w as m,i as x,v as y,d as R,F as f,j as v,f as _,k as r,t as a,g as w,T as S,m as E,r as C,o as l,e as b,n as D,p as V,l as T}from"./app-tVS7sfzb.js";const G={name:"DmsRec",mixins:[L],data(){return{rec_form:!1,RecData:{data:[]},Status:"",Sort:"desc",RecForm:{rec_id:"",customer_name:"",customer_phone:"",customer_address:"",customer_id:"",status:""},RecListForm:[],RecListFormEdit:{rec_name:"",price:"",qty:""},RecListEditID:"",PaySetting:{rec_discount:0,rec_vat:!1,rec_total:0,customer_pay:0},CustomerData:[]}},computed:{check_rec_form(){return this.RecListForm.length==0?!0:!!this.loading_post},TotalSum(){var s=0;return this.RecListForm.forEach(e=>{s+=e.price*e.qty}),s},TotalQty(){var s=0;return this.RecListForm.forEach(e=>{s+=parseInt(e.qty)}),s},CalVat(){let s=0;return this.PaySetting.rec_vat&&(s=(this.TotalSum-this.PaySetting.rec_discount)*7/100),s},CalTotal(){return this.TotalSum-this.PaySetting.rec_discount+this.CalVat}},mounted(){},methods:{Csearch(){this.SearchCus="",setTimeout(()=>{this.$refs.search_cus.focus()},600)},GetCus(){this.GetData(`cus/search?search=${this.SearchCus}`,s=>{this.CustomerData=s})},addCus(s,e,h,g,n,d){this.RecForm.customer_id=s,this.RecForm.customer_name=g=="female"?"ນ "+e+" "+h:e+" "+h,this.RecForm.customer_tel=n,this.RecForm.customer_address=d,this.CustomerData=[]},ChangeSort(){this.Sort=="asc"?this.Sort="desc":this.Sort="asc",this.GetRec()},GetRec(s){this.GetData(`rec/get?page=${s}&perpage=${this.PerPage}&sort=${this.Sort}&search=${this.Search}&status=${this.Status}`,e=>{this.RecData=e})},AddRecList(){this.rec_form=!0,this.RecListEditID="",this.RecListFormEdit={rec_name:"",price:"",qty:1},setTimeout(()=>{this.$refs.list_name.focus()},1e3)},EditRecList(s){this.rec_form=!0,this.RecListEditID=s,this.RecListForm.forEach(e=>{e.id==s&&(this.RecListFormEdit=e)})},SaveRecList(){this.RecListEditID?this.RecListForm.forEach(s=>{s.id==this.RecListEditID&&(s.rec_name=this.RecListFormEdit.rec_name,s.price=this.RecListFormEdit.price,s.qty=this.RecListFormEdit.qty)}):this.RecListForm.push(this.RecListFormEdit),this.rec_form=!1},DeleteRecList(s){this.RecListForm=this.RecListForm.filter(e=>e.id!==s)},CancelRecList(){this.rec_form=!1},AddRec(){this.RecForm={rec_id:"",customer_name:"",customer_phone:"",customer_address:"",customer_id:"",status:""},this.FormType=!0,this.RecListForm=[],this.PaySetting.rec_discount=0,this.PaySetting.customer_pay=0,this.PaySetting.rec_vat=!1;var s=new bootstrap.Modal(document.getElementById("rec_form"),{keyboard:!1});s.show()},EditRec(s){this.FormType=!1,this.PaySetting.customer_pay=0,this.EditData("rec/edit",s,e=>{this.RecForm=e.rec,this.PaySetting.rec_discount=e.rec.rec_discount,this.PaySetting.rec_vat=!!e.rec.rec_vat,this.RecListForm=e.rec_list;var h=new bootstrap.Modal(document.getElementById("rec_form"),{keyboard:!1});h.show()})},SaveRec(){this.FormType?this.AddData("rec/add",{rec_form:this.RecForm,rec_list_form:this.RecListForm,pay_setting:this.PaySetting},s=>{s.success&&(this.GetRec(),this.$refs.close_rec_form.click())}):this.UpdateData(`rec/update/${this.EditID}`,{rec_form:this.RecForm,rec_list_form:this.RecListForm,pay_setting:this.PaySetting},s=>{s.success&&(this.GetRec(),this.$refs.close_rec_form.click())})},DelRec(s){this.DeleteData("rec/delete",s,e=>{this.GetRec()})}},created(){this.GetRec()},watch:{Search:function(s){s==""&&this.GetRec()}}},i=s=>(V("data-v-ea3185ac"),s=s(),T(),s),I={class:"card"},j=i(()=>t("h5",{class:"card-header"},"ລາຍການໃບບິນ",-1)),q={class:"card-body"},U={class:"table-responsive text-nowrap"},A={class:"d-flex justify-content-between mb-2"},B={class:"d-flex justify-content-between align-items-center"},M={key:0,class:"bx bx-sort-up fs-4 me-2"},N={key:1,class:"bx bx-sort-down fs-4 me-2"},K=i(()=>t("option",{value:"10"},"10",-1)),Q=i(()=>t("option",{value:"20"},"20",-1)),z=i(()=>t("option",{value:"30"},"30",-1)),H=[K,Q,z],J=i(()=>t("option",{value:""},"ສະຖານະ",-1)),O=i(()=>t("option",{value:"padding"},"ກຳລັງດຳເນີນການ",-1)),W=i(()=>t("option",{value:"success"},"ສຳເລັດ",-1)),X=[J,O,W],Y={class:"d-flex"},Z={class:"table table-bordered"},$=i(()=>t("thead",null,[t("tr",{class:"table-info"},[t("th",{class:"fs-6 fw-bold"},"ເລກທີ່"),t("th",{class:"fs-6 fw-bold"},"ວັນທີ່"),t("th",{class:"fs-6 fw-bold"},"ລູກຄ້າ"),t("th",{class:"fs-6 fw-bold text-center"},"ລາຄາ"),t("th",{class:"fs-6 fw-bold"},"ສະຖານະ"),t("th",{class:"fs-6 fw-bold"},"ຜູ້ບັນທຶກ"),t("th",{class:"fs-6 fw-bold"},"ຈັດການ")])],-1)),tt={class:"text-end"},et={key:0,class:"badge bg-label-success me-1"},st={key:1,class:"badge bg-label-warning me-1"},ot={class:"text-center"},it={class:"dropdown"},nt=i(()=>t("button",{type:"button",class:"btn p-0 dropdown-toggle hide-arrow","data-bs-toggle":"dropdown"},[t("i",{class:"bx bx-dots-vertical-rounded"})],-1)),dt={class:"dropdown-menu"},ct=["onClick"],at=i(()=>t("i",{class:"bx bx-edit-alt me-1"},null,-1)),lt=["onClick"],rt=i(()=>t("i",{class:"bx bx-trash me-1"},null,-1)),_t={class:"modal modal-top modal-lg fade",id:"rec_form",tabindex:"-1",style:{display:"none"},"data-bs-backdrop":"static","aria-hidden":"true"},mt={class:"modal-dialog"},ht={class:"modal-content"},ut={class:"modal-header"},pt={type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",ref:"close_rec_form"},ft={class:"modal-body pt-0"},bt={class:"row mb-3"},yt={class:"col-md-6 fs-5 fw-bold"},vt={class:"text-danger"},gt=E('<div class="col-md-6 text-end" data-v-ea3185ac><button type="button" class="btn btn-warning me-2" data-v-ea3185ac><i class="bx bxs-printer" data-v-ea3185ac></i> 80mm </button><button type="button" class="btn btn-warning" data-v-ea3185ac><i class="bx bxs-printer" data-v-ea3185ac></i> A4 </button></div>',1),xt={key:0,class:"outer"},Rt={class:"row mb-2"},wt={class:"col-md-12"},St=i(()=>t("label",{for:"list-name",class:"form-label fs-6"},"ຊື່ລາຍການ",-1)),Ct={class:"row mb-2"},kt={class:"col-md-2"},Ft=i(()=>t("label",{for:"list-qty",class:"form-label fs-6"},"ຈຳນວນ",-1)),Lt={class:"col-md-3"},Pt=i(()=>t("label",{for:"list-price",class:"form-label fs-6"},"ລາຄາ",-1)),Et={class:"input-group"},Dt=i(()=>t("span",{class:"input-group-text"},"₭",-1)),Vt={class:"d-flex justify-content-end mt-4"},Tt={key:0},Gt={key:1,class:"spinner-border text-warning",role:"status"},It=i(()=>t("span",{class:"visually-hidden"},"Loading...",-1)),jt=[It],qt={key:0,class:"outer"},Ut={class:"row mb-2"},At={class:"col-md-6 d-flex justify-content-between"},Bt={key:0},Mt=i(()=>t("br",null,null,-1)),Nt={key:1},Kt={class:"btn-group"},Qt=i(()=>t("i",{class:"bx bx-search"},null,-1)),zt=[Qt],Ht={class:"dropdown-menu",style:{width:"max-content"}},Jt={class:"p-2"},Ot=["onClick"],Wt={key:0},Xt=i(()=>t("i",{class:"bx bxs-left-top-arrow-circle ms-2"},null,-1)),Yt={class:"col-md-6 text-end"},Zt=i(()=>t("span",{class:"me-4"},"ການຊຳລ່ະ: ",-1)),$t=i(()=>t("i",{class:"bx bx-plus fs-5"},null,-1)),te=[$t],ee={class:"table-responsive text-nowrap"},se={class:"table table-bordered align-middle table-nowrap mb-0"},oe=i(()=>t("thead",{class:"table-light"},[t("tr",null,[t("th",{scope:"col",width:"50",class:"text-center fs-6"}," ລຳດັບ "),t("th",{scope:"col",class:"fs-6"},"ເນື້ອໃນລາຍການ"),t("th",{scope:"col",width:"110",class:"text-center fs-6"}," ລາຄາ "),t("th",{scope:"col",width:"100",class:"text-center fs-6"}," ຈຳນວນ "),t("th",{scope:"col",width:"150",class:"text-end fs-6"}," ລວມ "),t("th",{scope:"col",class:"fs-6 text-center",width:"88"},"ຈັດການ")])],-1)),ie={class:"text-center"},ne={class:"text-end"},de={class:"text-center"},ce={class:"text-end"},ae={class:"text-center"},le={class:"dropdown"},re=i(()=>t("button",{type:"button",class:"btn p-0 dropdown-toggle hide-arrow","data-bs-toggle":"dropdown"},[t("i",{class:"bx bx-dots-vertical-rounded"})],-1)),_e={class:"dropdown-menu"},me=["onClick"],he=i(()=>t("i",{class:"bx bx-edit-alt me-1"},null,-1)),ue=["onClick"],pe=i(()=>t("i",{class:"bx bx-trash me-1"},null,-1)),fe=i(()=>t("td",{colspan:"3",class:"text-end fs-6"},"ລວມທັງໝົດ",-1)),be={class:"text-center"},ye={class:"text-end"},ve=i(()=>t("td",null,null,-1)),ge=i(()=>t("td",{colspan:"4",class:"text-end fs-6"},[r(" ສ່ວນຫຼຸດ "),t("i",{class:"mdi mdi-archive-edit align-middle fs-6 text-danger"})],-1)),xe={class:"text-end d-flex align-items-center"},Re=i(()=>t("span",{class:"fs-6",style:{"padding-top":"2px"}},"₭",-1)),we=i(()=>t("td",null,null,-1)),Se={colspan:"4",class:"text-end"},Ce={class:"d-flex justify-content-end fs-6"},ke={class:"form-check form-switch ms-2"},Fe={class:"text-end"},Le=i(()=>t("td",null,null,-1)),Pe={class:"table align-middle table-nowrap mb-0"},Ee=i(()=>t("td",{class:"text-end pe-2 fw-bold"},"ລວມເງິນຕ້ອງຈ່າຍ:",-1)),De={style:{width:"238px"},class:"border px-3 py-2 text-end fs-5 fw-bold"},Ve=i(()=>t("td",{class:"text-end pe-2 fw-bold text-info"},"ຮັບເງິນນຳລູກຄ້າ:",-1)),Te={style:{width:"238px"},class:"border px-3 py-2 text-end fs-5 fw-bold d-flex align-items-center"},Ge=i(()=>t("span",{class:"fs-6 p-0 text-info",style:{"padding-top":"6px"}},"₭",-1)),Ie={key:0},je=i(()=>t("td",{class:"text-end pe-2 fw-bold text-danger"},"ເງິນທອນ:",-1)),qe={style:{width:"238px"},class:"border text-danger px-3 py-2 text-end fs-5 fw-bold"},Ue={class:"d-flex justify-content-end mt-4"},Ae=["disabled"],Be={key:0},Me={key:1,class:"spinner-border text-warning",role:"status"},Ne=i(()=>t("span",{class:"visually-hidden"},"Loading...",-1)),Ke=[Ne],Qe=i(()=>t("button",{type:"button",class:"btn btn-label-secondary","data-bs-dismiss":"modal"},"ຍົກເລີກ",-1));function ze(s,e,h,g,n,d){const k=C("pagination"),u=C("cleave");return l(),c(f,null,[t("div",I,[j,t("div",q,[t("div",U,[t("div",A,[t("div",B,[t("div",{class:"cursor-pointer",onClick:e[0]||(e[0]=o=>d.ChangeSort())},[n.Sort=="asc"?(l(),c("i",M)):(l(),c("i",N))]),m(t("select",{class:"form-select me-2","onUpdate:modelValue":e[1]||(e[1]=o=>s.PerPage=o),onChange:e[2]||(e[2]=o=>d.GetRec())},H,544),[[x,s.PerPage]]),m(t("select",{class:"form-select me-2","onUpdate:modelValue":e[3]||(e[3]=o=>n.Status=o),onChange:e[4]||(e[4]=o=>d.GetRec())},X,544),[[x,n.Status]])]),t("div",Y,[m(t("input",{type:"text",class:"form-control me-2","onUpdate:modelValue":e[5]||(e[5]=o=>s.Search=o),onKeyup:e[6]||(e[6]=R(o=>d.GetRec(),["enter"])),placeholder:"ຄົ້ນຫາ..."},null,544),[[y,s.Search]]),t("button",{class:"btn btn-primary",onClick:e[7]||(e[7]=o=>d.AddRec())},"ເພີ່ມໃໝ່")])]),t("table",Z,[$,t("tbody",null,[(l(!0),c(f,null,v(n.RecData.data,o=>(l(),c("tr",{key:o.id},[t("td",null,a(o.rec_id),1),t("td",null,a(s.date(o.created_at)),1),t("td",null,a(o.customer_name),1),t("td",tt,a(s.formatPrice(o.total_price))+" ກີບ",1),t("td",null,[o.status=="success"?(l(),c("span",et,"ຊຳລ່ະແລ້ວ")):(l(),c("span",st,"ດຳເນີນການ"))]),t("td",null,a(o.user_name),1),t("td",ot,[t("div",it,[nt,t("div",dt,[t("a",{class:"dropdown-item",href:"javascript:void(0);",onClick:p=>d.EditRec(o.id)},[at,r(" ແກ້ໄຂ")],8,ct),t("a",{class:"dropdown-item",href:"javascript:void(0);",onClick:p=>d.DelRec(o.id)},[rt,r(" ລຶບ")],8,lt)])])])]))),128))])]),_(k,{pagination:n.RecData,onPaginate:e[8]||(e[8]=o=>d.GetRec(o)),offset:4},null,8,["pagination"])])])]),t("div",_t,[t("div",mt,[t("div",ht,[t("div",ut,[t("button",pt,null,512)]),t("div",ft,[t("div",bt,[t("div",yt,[r(" ໃບບິນເລກທີ່: "),t("span",vt,a(n.RecForm.rec_id),1)]),gt]),_(S,{name:"slide-fade"},{default:w(()=>[n.rec_form?(l(),c("div",xt,[t("div",Rt,[t("div",wt,[St,m(t("input",{type:"text",class:"form-control",id:"list-name",ref:"list_name","onUpdate:modelValue":e[9]||(e[9]=o=>n.RecListFormEdit.rec_name=o)},null,512),[[y,n.RecListFormEdit.rec_name]])])]),t("div",Ct,[t("div",kt,[Ft,_(u,{options:s.options,class:"form-control",id:"list-qty",modelValue:n.RecListFormEdit.qty,"onUpdate:modelValue":e[10]||(e[10]=o=>n.RecListFormEdit.qty=o)},null,8,["options","modelValue"])]),t("div",Lt,[Pt,t("div",Et,[_(u,{options:s.options,class:"form-control text-end",id:"list-price",modelValue:n.RecListFormEdit.price,"onUpdate:modelValue":e[11]||(e[11]=o=>n.RecListFormEdit.price=o)},null,8,["options","modelValue"]),Dt])])]),t("div",Vt,[t("button",{type:"button",class:"btn btn-primary me-2",onClick:e[12]||(e[12]=o=>d.SaveRecList())},[s.loading_post?(l(),c("div",Gt,jt)):(l(),c("span",Tt,"ບັນທຶກ"))]),t("button",{type:"button",class:"btn btn-label-secondary",onClick:e[13]||(e[13]=(...o)=>d.CancelRecList&&d.CancelRecList(...o))},"ຍົກເລີກ")])])):b("",!0)]),_:1}),_(S,{name:"slide-fade"},{default:w(()=>[n.rec_form?b("",!0):(l(),c("div",qt,[t("div",Ut,[t("div",At,[n.RecForm.customer_id?(l(),c("div",Bt,[t("span",null,"ລູກຄ້າ: "+a(n.RecForm.customer_name)+" ("+a(n.RecForm.customer_tel)+")",1),Mt,t("span",null,"ທີ່ຢູ່: "+a(n.RecForm.customer_address),1)])):(l(),c("div",Nt,"ລູກຄ້າ: ບຸກຄົນທົ່ວໄປ")),t("div",Kt,[t("button",{type:"button",class:"btn btn-icon rounded-pill btn-primary","data-bs-toggle":"dropdown","aria-expanded":"false",onClick:e[14]||(e[14]=o=>d.Csearch())},zt),t("div",Ht,[t("div",Jt,[m(t("input",{type:"text",class:"form-control rounded-pill",placeholder:"ຄົ້ນຫາລູກຄ້າ...","onUpdate:modelValue":e[15]||(e[15]=o=>s.SearchCus=o),onKeyup:e[16]||(e[16]=R(o=>d.GetCus(),["enter"])),ref:"search_cus"},null,544),[[y,s.SearchCus]])]),(l(!0),c(f,null,v(n.CustomerData,o=>(l(),c("a",{key:o.id,onClick:p=>d.addCus(o.id,o.name,o.last_name,o.gender,o.tel,o.address),class:"dropdown-item align-middle d-flex align-items-center justify-content-between cursor-pointer"},[t("span",null,[o.gender=="female"?(l(),c("span",Wt,"ນ")):b("",!0),r(" "+a(o.name)+" "+a(o.last_name),1)]),Xt],8,Ot))),128))])])]),t("div",Yt,[Zt,t("button",{type:"button",class:"btn rounded-pill btn-icon btn-danger me-2",onClick:e[17]||(e[17]=o=>d.AddRecList())},te)])]),t("div",ee,[t("table",se,[oe,t("tbody",null,[(l(!0),c(f,null,v(n.RecListForm,(o,p)=>(l(),c("tr",{key:o.id},[t("td",ie,a(p+1),1),t("td",null,a(o.rec_name),1),t("td",ne,a(s.formatPrice(o.price)),1),t("td",de,a(s.formatPrice(o.qty)),1),t("td",ce,a(s.formatPrice(o.price*o.qty)),1),t("td",ae,[t("div",le,[re,t("div",_e,[t("a",{class:"dropdown-item",href:"javascript:void(0);",onClick:F=>d.EditRecList(o.id)},[he,r(" ແກ້ໄຂ")],8,me),t("a",{class:"dropdown-item",href:"javascript:void(0);",onClick:F=>d.DeleteRecList(o.id)},[pe,r(" ລຶບ")],8,ue)])])])]))),128)),t("tr",null,[fe,t("td",be,a(s.formatPrice(d.TotalQty)),1),t("td",ye,a(s.formatPrice(d.TotalSum)),1),ve]),t("tr",null,[ge,t("td",xe,[_(u,{type:"text",class:"form-control p-1 fs-6 border-danger text-end border-1 me-1",options:s.options,modelValue:n.PaySetting.rec_discount,"onUpdate:modelValue":e[18]||(e[18]=o=>n.PaySetting.rec_discount=o)},null,8,["options","modelValue"]),Re]),we]),t("tr",null,[t("td",Se,[t("div",Ce,[r(" ອມພ(7%) "),t("div",ke,[m(t("input",{class:"form-check-input",type:"checkbox",role:"switch",checked:!1,"onUpdate:modelValue":e[19]||(e[19]=o=>n.PaySetting.rec_vat=o)},null,512),[[D,n.PaySetting.rec_vat]])])])]),t("td",Fe,a(s.formatPrice(d.CalVat))+" ₭ ",1),Le])])]),t("table",Pe,[t("tr",null,[Ee,t("td",De,a(s.formatPrice(d.CalTotal))+" ₭",1)]),t("tr",null,[Ve,t("td",Te,[_(u,{type:"text",class:"form-control text-info p-1 fs-5 fw-bold border-danger text-end border-1 me-1",options:s.options,modelValue:n.PaySetting.customer_pay,"onUpdate:modelValue":e[20]||(e[20]=o=>n.PaySetting.customer_pay=o)},null,8,["options","modelValue"]),Ge])]),n.PaySetting.customer_pay-d.CalTotal>0?(l(),c("tr",Ie,[je,t("td",qe,a(s.formatPrice(n.PaySetting.customer_pay-d.CalTotal))+" ₭",1)])):b("",!0)])]),t("div",Ue,[t("button",{type:"button",class:"btn btn-primary me-2",disabled:d.check_rec_form,onClick:e[21]||(e[21]=o=>d.SaveRec())},[s.loading_post?(l(),c("div",Me,Ke)):(l(),c("span",Be,"ບັນທຶກ"))],8,Ae),Qe])]))]),_:1})])])])])],64)}const Oe=P(G,[["render",ze],["__scopeId","data-v-ea3185ac"]]);export{Oe as default};
