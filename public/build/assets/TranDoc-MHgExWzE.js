import{m as F,h as x}from"./ulmixins-6Aw97T0R.js";import{_ as S,c as i,a as s,w as h,i as f,F as u,j as p,v as g,d as y,f as k,t as l,e as _,r as v,o as c,k as b,p as T,l as L}from"./app-tVS7sfzb.js";const G={name:"DmsTranDoc",mixins:[F],data(){return{upcp_pre:window.location.origin+"/assets/img/upload.png",TranDocData:{data:[]},Sort:"desc",DocCatData:[],Dcat:"",DocData:[],listDoc:"",DocSelecte:{},TranDocForm:{doc_cat:"",price:0,customer_id:"",customer_name:"",customer_tel:"",customer_address:"",status:"pendding"},ListDocForm:[],DocCatEdit:"",ListDocFormEdit:[],PriceEdit:"",CustomerData:[],SearchCus:"",notices:"",DocType:"",Status:""}},computed:{check_bt(){return this.TranDocForm.customer_id==""||this.TranDocForm.price==""?!0:!!this.loading_post}},mounted(){},methods:{ChangeSort(){this.Sort=="asc"?this.Sort="desc":this.Sort="asc",this.GetDocWork()},date(o){return x(o).format("DD/MM/YYYY")},onSelectDocCopy(o){var t=o.target.files[0];if(t){this.ListDocForm.length>0&&(this.ListDocForm.find(m=>m.doc_id==this.listDoc).doc_copy=t);var r=new FileReader;r.onloadend=()=>{t.type.includes("image")?this.upcp_pre=r.result:t.type.includes("word")?this.upcp_pre=this.baseURL+"/assets/img/word.png":t.type.includes("pdf")?this.upcp_pre=this.baseURL+"/assets/img/pdf.png":this.upcp_pre=this.baseURL+"/assets/img/document.png"},r.readAsDataURL(t)}},Csearch(){this.SearchCus="",setTimeout(()=>{this.$refs.search_cus.focus()},600)},addCus(o,t,r,m,n,a){this.TranDocForm.customer_id=o,this.TranDocForm.customer_name=m=="female"?"ນ "+t+" "+r:t+" "+r,this.TranDocForm.customer_tel=n,this.TranDocForm.customer_address=a,this.CustomerData=[]},ChDocCat(){this.GetDoc(this.Dcat),this.listDoc="",this.DocSelecte="",this.TranDocForm.doc_cat=this.Dcat,this.upcp_pre=window.location.origin+"/assets/img/upload.png",this.TranDocForm.price=this.DocCatData.find(o=>o.id==this.Dcat).price},AddDocWork(){this.TranDocForm={doc_cat:this.Dcat,price:0,customer_id:"",customer_name:"",customer_tel:"",customer_address:"",status:"pendding"},this.GetDoc(this.Dcat),this.FormType=!0,this.SearchCus="",this.CustomerData=[],this.notices="",this.prices="",this.upcp_pre=window.location.origin+"/assets/img/upload.png",this.TranDocForm.price=this.DocCatData.find(t=>t.id==this.Dcat).price;var o=new bootstrap.Modal(document.getElementById("tran_doc"),{keyboard:!1});o.show()},SaveDocWork(){this.FormType?this.AddData("dwork/add",{doc_form:this.TranDocForm,list_doc:this.ListDocForm},o=>{o.success&&(this.GetDocWork(),this.$refs.close_tran_doc.click())}):this.UpdateData(`dwork/update/${this.EditID}`,{doc_form:this.TranDocForm,list_doc:this.ListDocForm},o=>{o.success&&(this.GetDocWork(),this.$refs.close_tran_doc.click())})},EditDocWork(o){this.EditData("dwork/edit",o,t=>{this.Dcat=t.docwork.doc_cat,this.GetDocEd(t.docwork.doc_cat),this.TranDocForm=t.docwork,this.ListDocForm=t.docwork_list,this.DocCatEdit=t.docwork.doc_cat,this.ListDocFormEdit=t.docwork_list,this.PriceEdit=t.docwork.price,this.FormType=!1;var r=new bootstrap.Modal(document.getElementById("tran_doc"),{keyboard:!1});r.show()})},DelDocWork(o){this.DeleteData("dwork/delete",o,t=>{t.success&&this.GetDocWork()})},GetDocWork(o){this.GetData(`dwork/get?page=${o}&perpage=${this.PerPage}&sort=${this.Sort}&search=${this.Search}&status=${this.Status}&doc_cat=${this.DocType}`,t=>{this.TranDocData=t})},GetDocCat(){this.GetData("doccat",o=>{this.DocCatData=o.data})},GetCus(){this.GetData(`cus/search?search=${this.SearchCus}`,o=>{this.CustomerData=o})},GetDocEd(o){this.GetData("doc/get/"+o,t=>{this.DocData=t,this.DocData.length>0&&this.Shdoc(this.DocData[0].id)})},GetDoc(o){this.GetData("doc/get/"+o,t=>{this.DocData=t,this.FormType?this.ListDocForm=t.map(r=>({doc_work_id:null,doc_id:r.id,doc_copy:null,notice:null,status:"pendding"})):this.Dcat==this.DocCatEdit?(this.ListDocForm=this.ListDocFormEdit,this.TranDocForm.price=this.PriceEdit):this.ListDocForm=t.map(r=>({doc_work_id:null,doc_id:r.id,doc_copy:null,notice:null,status:"pendding"})),this.DocData.length>0&&(this.listDoc=this.DocData[0].id,this.Shdoc(this.DocData[0].id))})},Shdoc(o){if(o){if(this.listDoc=o,this.DocSelecte=this.DocData.find(t=>t.id==o),this.ListDocForm.find(t=>t.doc_id==o).doc_copy==""||this.ListDocForm.find(t=>t.doc_id==o).doc_copy==null)this.upcp_pre=window.location.origin+"/assets/img/upload.png";else{let t=this.ListDocForm.find(r=>r.doc_id==o).doc_copy;t.type?t.type.includes("image")?this.upcp_pre=URL.createObjectURL(t):t.type.includes("word")?this.upcp_pre=this.baseURL+"/assets/img/word.png":t.type.includes("pdf")?this.upcp_pre=this.baseURL+"/assets/img/pdf.png":this.upcp_pre=this.baseURL+"/assets/img/document.png":t.includes("jpg")||t.includes("jpeg")||t.includes("png")?this.upcp_pre=this.baseURL+"/assets/file/"+t:t.includes("doc")||t.includes("docx")?this.upcp_pre=this.baseURL+"/assets/img/word.png":t.includes("pdf")?this.upcp_pre=this.baseURL+"/assets/img/pdf.png":this.upcp_pre=this.baseURL+"/assets/img/document.png"}this.ListDocForm.find(t=>t.doc_id==o).notice?this.notices=this.ListDocForm.find(t=>t.doc_id==o).notice:this.notices=""}}},created(){this.GetDocCat(),this.GetDocWork()},watch:{Search:function(o){o.length==""&&this.GetDocWork()},SearchCus:function(o){o.length==0&&(this.CustomerData=[])},DocCatData:function(o){if(o.length>0)if(this.Dcat==""){let t=o[0].id;this.GetDoc(t),this.Dcat=t}else{let t=this.Dcat;this.GetDoc(t)}},notices:function(o){o&&(this.ListDocForm.find(t=>t.doc_id==this.listDoc).notice=o)}}},d=o=>(T("data-v-2da3bc02"),o=o(),L(),o),U={class:"card"},W=d(()=>s("h5",{class:"card-header"},"ລາຍການເອກະສານ",-1)),E={class:"card-body"},R={class:"table-responsive text-nowrap"},V={class:"d-flex justify-content-between mb-2"},j={class:"d-flex justify-content-between align-items-center"},P={key:0,class:"bx bx-sort-up fs-4 me-2"},I={key:1,class:"bx bx-sort-down fs-4 me-2"},M=d(()=>s("option",{value:"10"},"10",-1)),B=d(()=>s("option",{value:"20"},"20",-1)),A=d(()=>s("option",{value:"30"},"30",-1)),N=[M,B,A],Y=d(()=>s("option",{value:""},"ປະເພດເອກະສານ",-1)),K=["value"],O=d(()=>s("option",{value:""},"ສະຖານະ",-1)),q=d(()=>s("option",{value:"padding"},"ກຳລັງດຳເນີນການ",-1)),z=d(()=>s("option",{value:"success"},"ສຳເລັດ",-1)),H=[O,q,z],J={class:"d-flex"},Q={class:"table table-bordered"},X=d(()=>s("thead",null,[s("tr",{class:"table-info"},[s("th",{class:"fs-6 fw-bold"},"ເລກທີ່"),s("th",{class:"fs-6 fw-bold"},"ວັນທີ່"),s("th",{class:"fs-6 fw-bold"},"ປະເພດເອກະສານ"),s("th",{class:"fs-6 fw-bold"},"ລູກຄ້າ"),s("th",{class:"fs-6 fw-bold text-center"},"ສະຖານະ"),s("th",{class:"fs-6 fw-bold text-center"},"ຊຳລ່ະ"),s("th",{class:"fs-6 fw-bold"},"ຜູ້ບັນທຶກ"),s("th",{class:"fs-6 fw-bold"},"ຈັດການ")])],-1)),Z={key:0},$={key:1},tt={key:0,class:"badge bg-label-success me-1"},st={key:1,class:"badge bg-label-warning me-1"},et={key:0,class:"badge bg-label-success me-1"},ot={key:1,class:"badge bg-label-warning me-1"},it={class:"text-center"},ct={class:"dropdown"},nt=d(()=>s("button",{type:"button",class:"btn p-0 dropdown-toggle hide-arrow","data-bs-toggle":"dropdown"},[s("i",{class:"bx bx-dots-vertical-rounded"})],-1)),dt={class:"dropdown-menu"},at=["onClick"],rt=d(()=>s("i",{class:"bx bx-edit-alt me-1"},null,-1)),lt=["onClick"],ht=d(()=>s("i",{class:"bx bx-trash me-1"},null,-1)),ut={class:"modal modal-top modal-lg fade",id:"tran_doc",tabindex:"-1",style:{display:"none"},"data-bs-backdrop":"static","aria-hidden":"true"},pt={class:"modal-dialog"},_t={class:"modal-content"},mt={class:"modal-header"},Dt={type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",ref:"close_tran_doc"},ft={class:"modal-body pt-0"},bt={class:"row"},gt={class:"col-6 mb-3 d-flex justify-content-between"},yt={key:0},kt=d(()=>s("br",null,null,-1)),vt=d(()=>s("br",null,null,-1)),wt={key:1},Ct={class:"d-flex justify-content-start mb-2"},Ft={class:"btn-group"},xt=d(()=>s("i",{class:"bx bx-search"},null,-1)),St=[xt],Tt={class:"dropdown-menu",style:{width:"max-content"}},Lt={class:"p-2"},Gt=["onClick"],Ut={key:0},Wt=d(()=>s("i",{class:"bx bxs-left-top-arrow-circle ms-2"},null,-1)),Et=d(()=>s("div",{class:"col-6 mb-3"},null,-1)),Rt={class:"row"},Vt={class:"col-md-6"},jt={class:"mb-3"},Pt=d(()=>s("label",{for:"doctype",class:"col-form-label fs-6"},"ປະເພດເອກະສານ:",-1)),It=["value"],Mt={class:"d-flex align-items-center"},Bt=d(()=>s("h6",{class:"m-0"},"ເອກະສານ ທີ່ຕ້ອງປະກອບ",-1)),At={key:0,class:"spinner-grow spinner-grow-sm text-warning ms-2",role:"status"},Nt=d(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),Yt=[Nt],Kt={class:"demo-inline-spacing mt-3"},Ot={class:"list-group"},qt=["onClick"],zt={key:0,class:"bx bxs-right-arrow-circle fs-4 text-warning"},Ht={class:"col-md-6"},Jt={key:0,class:"form-label fs-6"},Qt={key:1,class:"input-group"},Xt=d(()=>s("span",{class:"input-group-text cursor-pointer"}," ກີບ ",-1)),Zt={class:"mb-3"},$t=d(()=>s("label",{for:"nitice",class:"fs-6 text-warning"},"ໝາຍເຫດ: ",-1)),ts={class:"mb-3"},ss=d(()=>s("label",{for:"",class:"fs-6 mb-2"},"ເອກະສານ:",-1)),es=d(()=>s("br",null,null,-1)),os=["src"],is={class:"d-flex justify-content-end mt-4"},cs=["disabled"],ns={key:0},ds={key:1,class:"spinner-border text-warning",role:"status"},as=d(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),rs=[as],ls=d(()=>s("button",{type:"button",class:"btn btn-label-secondary","data-bs-dismiss":"modal"},"ຍົກເລີກ",-1));function hs(o,t,r,m,n,a){const w=v("pagination"),C=v("cleave");return c(),i(u,null,[s("div",U,[W,s("div",E,[s("div",R,[s("div",V,[s("div",j,[s("div",{class:"cursor-pointer",onClick:t[0]||(t[0]=e=>a.ChangeSort())},[n.Sort=="asc"?(c(),i("i",P)):(c(),i("i",I))]),h(s("select",{class:"form-select me-2","onUpdate:modelValue":t[1]||(t[1]=e=>o.PerPage=e),onChange:t[2]||(t[2]=e=>a.GetDocWork())},N,544),[[f,o.PerPage]]),h(s("select",{class:"form-select me-2",onChange:t[3]||(t[3]=e=>a.GetDocWork()),"onUpdate:modelValue":t[4]||(t[4]=e=>n.DocType=e)},[Y,(c(!0),i(u,null,p(n.DocCatData,e=>(c(),i("option",{key:e.id,value:e.id},l(e.name),9,K))),128))],544),[[f,n.DocType]]),h(s("select",{class:"form-select me-2","onUpdate:modelValue":t[5]||(t[5]=e=>n.Status=e),onChange:t[6]||(t[6]=e=>a.GetDocWork())},H,544),[[f,n.Status]])]),s("div",J,[h(s("input",{type:"text",class:"form-control me-2",placeholder:"ຄົ້ນຫາ...","onUpdate:modelValue":t[7]||(t[7]=e=>o.Search=e),onKeyup:t[8]||(t[8]=y(e=>a.GetDocWork(),["enter"]))},null,544),[[g,o.Search]]),s("button",{class:"btn btn-primary",onClick:t[9]||(t[9]=e=>a.AddDocWork())},"ເພີ່ມໃໝ່")])]),s("table",Q,[X,s("tbody",null,[(c(!0),i(u,null,p(n.TranDocData.data,e=>(c(),i("tr",{key:e},[s("td",null,l(e.dw_id),1),s("td",null,l(a.date(e.created_at)),1),s("td",null,l(e.doc_cat_name),1),s("td",null,[e.customer_name?(c(),i("span",Z,l(e.customer_name),1)):(c(),i("span",$,"ລູກຄ້າທົ່ວໄປ"))]),s("td",null,[e.status=="success"?(c(),i("span",tt,"ສຳເລັດ")):(c(),i("span",st,"ດຳເນີນການ"))]),s("td",null,[e.rec_status=="success"?(c(),i("span",et,"ສຳເລັດ")):(c(),i("span",ot,"ດຳເນີນການ"))]),s("td",null,l(e.user_name),1),s("td",it,[s("div",ct,[nt,s("div",dt,[s("a",{class:"dropdown-item",href:"javascript:void(0);",onClick:D=>a.EditDocWork(e.id)},[rt,b(" ແກ້ໄຂ")],8,at),s("a",{class:"dropdown-item",href:"javascript:void(0);",onClick:D=>a.DelDocWork(e.id)},[ht,b(" ລຶບ")],8,lt)])])])]))),128))])]),k(w,{pagination:n.TranDocData,onPaginate:t[10]||(t[10]=e=>a.GetDocWork(e)),offset:4},null,8,["pagination"])])])]),s("div",ut,[s("div",pt,[s("div",_t,[s("div",mt,[s("button",Dt,null,512)]),s("div",ft,[s("div",bt,[s("div",gt,[s("div",null,[n.TranDocForm.customer_id?(c(),i("div",yt,[s("span",null,"ຊື່: "+l(n.TranDocForm.customer_name),1),kt,s("span",null,"ທີ່ຢູ່: "+l(n.TranDocForm.customer_address),1),vt,s("span",null,"ເບີໂທ: "+l(n.TranDocForm.customer_tel),1)])):(c(),i("div",wt," ລູກຄ້າທົວໄປ "))]),s("div",null,[s("div",Ct,[s("div",Ft,[s("button",{type:"button",class:"btn btn-icon rounded-pill btn-primary","data-bs-toggle":"dropdown","aria-expanded":"false",onClick:t[11]||(t[11]=e=>a.Csearch())},St),s("div",Tt,[s("div",Lt,[h(s("input",{type:"text",class:"form-control rounded-pill",placeholder:"ຄົ້ນຫາ...","onUpdate:modelValue":t[12]||(t[12]=e=>n.SearchCus=e),onKeyup:t[13]||(t[13]=y(e=>a.GetCus(),["enter"])),ref:"search_cus"},null,544),[[g,n.SearchCus]])]),(c(!0),i(u,null,p(n.CustomerData,e=>(c(),i("a",{key:e.id,onClick:D=>a.addCus(e.id,e.name,e.last_name,e.gender,e.tel,e.address),class:"dropdown-item align-middle d-flex align-items-center justify-content-between cursor-pointer"},[s("span",null,[e.gender=="female"?(c(),i("span",Ut,"ນ")):_("",!0),b(" "+l(e.name)+" "+l(e.last_name),1)]),Wt],8,Gt))),128))])])])])]),Et]),s("div",Rt,[s("div",Vt,[s("div",jt,[Pt,h(s("select",{id:"doctype","onUpdate:modelValue":t[14]||(t[14]=e=>n.Dcat=e),onChange:t[15]||(t[15]=e=>a.ChDocCat()),class:"form-select"},[(c(!0),i(u,null,p(n.DocCatData,e=>(c(),i("option",{key:e.id,value:e.id},l(e.name),9,It))),128))],544),[[f,n.Dcat]])]),s("div",Mt,[Bt,o.loading_table?(c(),i("div",At,Yt)):_("",!0)]),s("div",Kt,[s("ol",Ot,[(c(!0),i(u,null,p(n.DocData,(e,D)=>(c(),i("li",{key:e.id,onClick:us=>a.Shdoc(e.id),class:"list-group-item d-flex justify-content-between align-items-center cursor-pointer"},[s("span",null,l(D+1)+". "+l(e.doc_name),1),b(),n.listDoc==e.id?(c(),i("i",zt)):_("",!0)],8,qt))),128))])])]),s("div",Ht,[o.FormType?(c(),i("label",Jt,"ລາຄາບໍລິການ: ")):_("",!0),o.FormType?(c(),i("div",Qt,[k(C,{options:o.options,modelValue:n.TranDocForm.price,"onUpdate:modelValue":t[16]||(t[16]=e=>n.TranDocForm.price=e),class:"form-control text-end",placeholder:"...."},null,8,["options","modelValue"]),Xt])):_("",!0),s("div",Zt,[$t,h(s("textarea",{name:"",id:"nitice","onUpdate:modelValue":t[17]||(t[17]=e=>n.notices=e),class:"form-control",rows:"5"},null,512),[[g,n.notices]])]),s("div",ts,[ss,es,s("img",{src:n.upcp_pre,class:"rounded exp-img cursor-pointer",onClick:t[18]||(t[18]=e=>o.$refs.doc_copy.click())},null,8,os),s("input",{type:"file",ref:"doc_copy",onChange:t[19]||(t[19]=(...e)=>a.onSelectDocCopy&&a.onSelectDocCopy(...e)),style:{display:"none"},class:"form-control",placeholder:"...."},null,544)])])]),s("div",is,[s("button",{type:"button",class:"btn btn-primary me-2",onClick:t[20]||(t[20]=e=>a.SaveDocWork()),disabled:a.check_bt},[o.loading_post?(c(),i("div",ds,rs)):(c(),i("span",ns,"ບັນທຶກ"))],8,cs),ls])])])])])],64)}const ms=S(G,[["render",hs],["__scopeId","data-v-2da3bc02"]]);export{ms as default};
