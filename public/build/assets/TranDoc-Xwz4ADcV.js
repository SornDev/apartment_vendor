import{m as F,h as S}from"./ulmixins-3GuYya29.js";import{_ as T,u as L,c as i,a as s,w as u,m as g,F as p,r as m,h as b,j as y,f as h,e as k,t as _,g as w,o as c,n as C,d as G,b as D,p as E,q as U}from"./app-R5zms-zh.js";const W={setup(){return{store:L()}},name:"DmsTranDoc",mixins:[F],data(){return{upcp_pre:window.location.origin+"/assets/img/upload.png",TranDocData:{data:[]},Sort:"desc",DocCatData:[],Dcat:"",DocData:[],listDoc:"",DocSelecte:{},TranDocForm:{doc_cat:"",price:0,customer_id:"",customer_name:"",customer_tel:"",customer_address:"",status:"pendding"},ListDocForm:[],DocCatEdit:"",ListDocFormEdit:[],PriceEdit:"",CustomerData:[],SearchCus:"",notices:"",DocType:"",Status:""}},computed:{check_bt(){return this.TranDocForm.customer_id==""||this.TranDocForm.price==""?!0:!!this.loading_post}},mounted(){},methods:{ChangeSort(){this.Sort=="asc"?this.Sort="desc":this.Sort="asc",this.GetDocWork()},date(o){return S(o).format("DD/MM/YYYY")},onSelectDocCopy(o){var t=o.target.files[0];if(t){this.ListDocForm.length>0&&(this.ListDocForm.find(r=>r.doc_id==this.listDoc).doc_copy=t);var l=new FileReader;l.onloadend=()=>{t.type.includes("image")?this.upcp_pre=l.result:t.type.includes("word")?this.upcp_pre=this.baseURL+"/assets/img/word.png":t.type.includes("pdf")?this.upcp_pre=this.baseURL+"/assets/img/pdf.png":this.upcp_pre=this.baseURL+"/assets/img/document.png"},l.readAsDataURL(t)}},Csearch(){this.SearchCus="",setTimeout(()=>{this.$refs.search_cus.focus()},600)},addCus(o,t,l,r,d,a){this.TranDocForm.customer_id=o,this.TranDocForm.customer_name=r=="female"?"ນ "+t+" "+l:t+" "+l,this.TranDocForm.customer_tel=d,this.TranDocForm.customer_address=a,this.CustomerData=[]},ChDocCat(){this.GetDoc(this.Dcat),this.listDoc="",this.DocSelecte="",this.TranDocForm.doc_cat=this.Dcat,this.upcp_pre=window.location.origin+"/assets/img/upload.png",this.TranDocForm.price=this.DocCatData.find(o=>o.id==this.Dcat).price},AddDocWork(){this.TranDocForm={doc_cat:this.Dcat,price:0,customer_id:"",customer_name:"",customer_tel:"",customer_address:"",status:"pendding"},this.GetDoc(this.Dcat),this.FormType=!0,this.SearchCus="",this.CustomerData=[],this.notices="",this.prices="",this.upcp_pre=window.location.origin+"/assets/img/upload.png",this.TranDocForm.price=this.DocCatData.find(t=>t.id==this.Dcat).price;var o=new bootstrap.Modal(document.getElementById("tran_doc"),{keyboard:!1});o.show()},SaveDocWork(){this.FormType?this.AddData("dwork/add",{doc_form:this.TranDocForm,list_doc:this.ListDocForm},o=>{o.success&&(this.GetDocWork(),this.$refs.close_tran_doc.click())}):this.UpdateData(`dwork/update/${this.EditID}`,{doc_form:this.TranDocForm,list_doc:this.ListDocForm},o=>{o.success&&(this.GetDocWork(),this.$refs.close_tran_doc.click())})},EditDocWork(o){this.EditData("dwork/edit",o,t=>{this.Dcat=t.docwork.doc_cat,this.GetDocEd(t.docwork.doc_cat),this.TranDocForm=t.docwork,this.ListDocForm=t.docwork_list,this.DocCatEdit=t.docwork.doc_cat,this.ListDocFormEdit=t.docwork_list,this.PriceEdit=t.docwork.price,this.FormType=!1;var l=new bootstrap.Modal(document.getElementById("tran_doc"),{keyboard:!1});l.show()})},DelDocWork(o){this.DeleteData("dwork/delete",o,t=>{t.success&&this.GetDocWork()})},GetDocWork(o){this.GetData(`dwork/get?page=${o}&perpage=${this.PerPage}&sort=${this.Sort}&search=${this.Search}&status=${this.Status}&doc_cat=${this.DocType}`,t=>{this.TranDocData=t})},GetDocCat(){this.GetData("doccat",o=>{this.DocCatData=o.data})},GetCus(){this.GetData(`cus/search?search=${this.SearchCus}`,o=>{this.CustomerData=o})},GetDocEd(o){this.GetData("doc/get/"+o,t=>{this.DocData=t,this.DocData.length>0&&this.Shdoc(this.DocData[0].id)})},GetDoc(o){this.GetData("doc/get/"+o,t=>{this.DocData=t,this.FormType?this.ListDocForm=t.map(l=>({doc_work_id:null,doc_id:l.id,doc_copy:null,notice:null,status:"pendding"})):this.Dcat==this.DocCatEdit?(this.ListDocForm=this.ListDocFormEdit,this.TranDocForm.price=this.PriceEdit):this.ListDocForm=t.map(l=>({doc_work_id:null,doc_id:l.id,doc_copy:null,notice:null,status:"pendding"})),this.DocData.length>0&&(this.listDoc=this.DocData[0].id,this.Shdoc(this.DocData[0].id))})},Shdoc(o){if(o){if(this.listDoc=o,this.DocSelecte=this.DocData.find(t=>t.id==o),this.ListDocForm.find(t=>t.doc_id==o).doc_copy==""||this.ListDocForm.find(t=>t.doc_id==o).doc_copy==null)this.upcp_pre=window.location.origin+"/assets/img/upload.png";else{let t=this.ListDocForm.find(l=>l.doc_id==o).doc_copy;t.type?t.type.includes("image")?this.upcp_pre=URL.createObjectURL(t):t.type.includes("word")?this.upcp_pre=this.baseURL+"/assets/img/word.png":t.type.includes("pdf")?this.upcp_pre=this.baseURL+"/assets/img/pdf.png":this.upcp_pre=this.baseURL+"/assets/img/document.png":t.includes("jpg")||t.includes("jpeg")||t.includes("png")?this.upcp_pre=this.baseURL+"/assets/file/"+t:t.includes("doc")||t.includes("docx")?this.upcp_pre=this.baseURL+"/assets/img/word.png":t.includes("pdf")?this.upcp_pre=this.baseURL+"/assets/img/pdf.png":this.upcp_pre=this.baseURL+"/assets/img/document.png"}this.ListDocForm.find(t=>t.doc_id==o).notice?this.notices=this.ListDocForm.find(t=>t.doc_id==o).notice:this.notices=""}}},created(){this.GetDocCat(),this.GetDocWork()},watch:{Search:function(o){o.length==""&&this.GetDocWork()},SearchCus:function(o){o.length==0&&(this.CustomerData=[])},DocCatData:function(o){if(o.length>0)if(this.Dcat==""){let t=o[0].id;this.GetDoc(t),this.Dcat=t}else{let t=this.Dcat;this.GetDoc(t)}},notices:function(o){o&&(this.ListDocForm.find(t=>t.doc_id==this.listDoc).notice=o)}}},n=o=>(E("data-v-eac75c0c"),o=o(),U(),o),R={class:"card"},V=n(()=>s("h5",{class:"card-header"},"ລາຍການເອກະສານ",-1)),j={class:"card-body"},O={class:"table-responsive text-nowrap"},A={class:"d-flex justify-content-between mb-2"},I={class:"d-flex justify-content-between align-items-center"},P={key:0,class:"bx bx-sort-up fs-4 me-2"},N={key:1,class:"bx bx-sort-down fs-4 me-2"},M=n(()=>s("option",{value:"10"},"10",-1)),B=n(()=>s("option",{value:"20"},"20",-1)),J=n(()=>s("option",{value:"30"},"30",-1)),Y=[M,B,J],K=n(()=>s("option",{value:""},"ປະເພດເອກະສານ",-1)),z=["value"],q=n(()=>s("option",{value:""},"ສະຖານະ",-1)),H=n(()=>s("option",{value:"padding"},"ກຳລັງດຳເນີນການ",-1)),Q=n(()=>s("option",{value:"success"},"ສຳເລັດ",-1)),X=[q,H,Q],Z={class:"d-flex"},$={class:"table table-bordered"},tt={class:"table-info"},st=n(()=>s("th",{class:"fs-6 fw-bold"},"ເລກທີ່",-1)),et=n(()=>s("th",{class:"fs-6 fw-bold"},"ວັນທີ່",-1)),ot=n(()=>s("th",{class:"fs-6 fw-bold"},"ປະເພດເອກະສານ",-1)),it=n(()=>s("th",{class:"fs-6 fw-bold"},"ລູກຄ້າ",-1)),ct=n(()=>s("th",{class:"fs-6 fw-bold text-center"},"ເອກະສານ",-1)),nt=n(()=>s("th",{class:"fs-6 fw-bold text-center"},"ຊຳລ່ະ",-1)),dt=n(()=>s("th",{class:"fs-6 fw-bold"},"ຜູ້ບັນທຶກ",-1)),at={key:0,class:"fs-6 fw-bold"},rt={key:0},lt={key:0},_t={key:1},ht={class:"progress w-75 me-2",style:{height:"8px"}},ut={key:0,class:"badge bg-label-success me-1"},pt={key:1,class:"badge bg-label-warning me-1"},mt={key:0,class:"text-center"},Dt={class:"dropdown"},ft=n(()=>s("button",{type:"button",class:"btn p-0 dropdown-toggle hide-arrow","data-bs-toggle":"dropdown"},[s("i",{class:"bx bx-dots-vertical-rounded"})],-1)),gt={class:"dropdown-menu"},bt=["onClick"],yt=n(()=>s("i",{class:"bx bx-edit-alt me-1"},null,-1)),kt=["onClick"],wt=n(()=>s("i",{class:"bx bx-trash me-1"},null,-1)),Ct={key:1},vt=n(()=>s("tr",null,[s("td",{colspan:"8",class:"text-center"},[s("i",{class:"bx bxs-data me-1"}),D(" ບໍ່ມີຂໍ້ມູນ ")])],-1)),xt=[vt],Ft={class:"modal modal-top modal-lg fade",id:"tran_doc",tabindex:"-1",style:{display:"none"},"data-bs-backdrop":"static","aria-hidden":"true"},St={class:"modal-dialog"},Tt={class:"modal-content"},Lt={class:"modal-header"},Gt={type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",ref:"close_tran_doc"},Et={class:"modal-body pt-0"},Ut={class:"row"},Wt={class:"col-6 mb-3 d-flex justify-content-between"},Rt={key:0},Vt=n(()=>s("br",null,null,-1)),jt=n(()=>s("br",null,null,-1)),Ot={key:1},At={class:"d-flex justify-content-start mb-2"},It={class:"btn-group"},Pt=n(()=>s("i",{class:"bx bx-search"},null,-1)),Nt=[Pt],Mt={class:"dropdown-menu",style:{width:"max-content"}},Bt={class:"p-2"},Jt=["onClick"],Yt={key:0},Kt=n(()=>s("i",{class:"bx bxs-left-top-arrow-circle ms-2"},null,-1)),zt=n(()=>s("div",{class:"col-6 mb-3"},null,-1)),qt={class:"row"},Ht={class:"col-md-6"},Qt={class:"mb-3"},Xt=n(()=>s("label",{for:"doctype",class:"col-form-label fs-6"},"ປະເພດເອກະສານ:",-1)),Zt=["value"],$t={class:"d-flex align-items-center"},ts=n(()=>s("h6",{class:"m-0"},"ເອກະສານ ທີ່ຕ້ອງປະກອບ",-1)),ss={key:0,class:"spinner-grow spinner-grow-sm text-warning ms-2",role:"status"},es=n(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),os=[es],is={class:"demo-inline-spacing mt-3"},cs={class:"list-group"},ns=["onClick"],ds={key:0,class:"bx bxs-right-arrow-circle fs-4 text-warning"},as={class:"col-md-6"},rs={key:0,class:"form-label fs-6"},ls={key:1,class:"input-group"},_s=n(()=>s("span",{class:"input-group-text cursor-pointer"}," ກີບ ",-1)),hs={class:"mb-3"},us=n(()=>s("label",{for:"nitice",class:"fs-6 text-warning"},"ໝາຍເຫດ: ",-1)),ps={class:"mb-3"},ms=n(()=>s("label",{for:"",class:"fs-6 mb-2"},"ເອກະສານ:",-1)),Ds=n(()=>s("br",null,null,-1)),fs=["src"],gs={class:"d-flex justify-content-end mt-4"},bs=["disabled"],ys={key:0},ks={key:1,class:"spinner-border text-warning",role:"status"},ws=n(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),Cs=[ws],vs=n(()=>s("button",{type:"button",class:"btn btn-label-secondary","data-bs-dismiss":"modal"},"ຍົກເລີກ",-1));function xs(o,t,l,r,d,a){const v=w("pagination"),x=w("cleave");return c(),i(p,null,[s("div",R,[V,s("div",j,[s("div",O,[s("div",A,[s("div",I,[s("div",{class:"cursor-pointer",onClick:t[0]||(t[0]=e=>a.ChangeSort())},[d.Sort=="asc"?(c(),i("i",P)):(c(),i("i",N))]),u(s("select",{class:"form-select me-2","onUpdate:modelValue":t[1]||(t[1]=e=>o.PerPage=e),onChange:t[2]||(t[2]=e=>a.GetDocWork())},Y,544),[[g,o.PerPage]]),u(s("select",{class:"form-select me-2",onChange:t[3]||(t[3]=e=>a.GetDocWork()),"onUpdate:modelValue":t[4]||(t[4]=e=>d.DocType=e)},[K,(c(!0),i(p,null,m(d.DocCatData,e=>(c(),i("option",{key:e.id,value:e.id},_(e.name),9,z))),128))],544),[[g,d.DocType]]),u(s("select",{class:"form-select me-2","onUpdate:modelValue":t[5]||(t[5]=e=>d.Status=e),onChange:t[6]||(t[6]=e=>a.GetDocWork())},X,544),[[g,d.Status]])]),s("div",Z,[u(s("input",{type:"text",class:"form-control me-2",placeholder:"ຄົ້ນຫາ...","onUpdate:modelValue":t[7]||(t[7]=e=>o.Search=e),onKeyup:t[8]||(t[8]=y(e=>a.GetDocWork(),["enter"]))},null,544),[[b,o.Search]]),r.store.get_permissions.includes("DOC_ACC_EDIT")||JSON.parse(r.store.get_user).user_type=="admin"?(c(),i("button",{key:0,class:"btn btn-primary",onClick:t[9]||(t[9]=e=>a.AddDocWork())},"ເພີ່ມໃໝ່")):h("",!0)])]),s("table",$,[s("thead",null,[s("tr",tt,[st,et,ot,it,ct,nt,dt,r.store.get_permissions.includes("DOC_ACC_EDIT")||r.store.get_permissions.includes("DOC_ACC_DEL")||JSON.parse(r.store.get_user).user_type=="admin"?(c(),i("th",at,"ຈັດການ")):h("",!0)])]),d.TranDocData.data.length>0?(c(),i("tbody",rt,[(c(!0),i(p,null,m(d.TranDocData.data,e=>(c(),i("tr",{key:e},[s("td",null,_(e.dw_id),1),s("td",null,_(a.date(e.created_at)),1),s("td",null,_(e.doc_cat_name),1),s("td",null,[e.customer_name?(c(),i("span",lt,_(e.customer_name),1)):(c(),i("span",_t,"ລູກຄ້າທົ່ວໄປ"))]),s("td",null,[s("div",{class:C(["d-flex align-items-center",e.work_file<80?"text-danger":"text-info"])},[s("div",ht,[s("div",{class:C(["progress-bar",e.work_file<80?"bg-danger":"bg-info"]),style:G("width:"+e.work_file+"%"),role:"progressbar","aria-valuenow":"78","aria-valuemin":"0","aria-valuemax":"100"},null,6)]),s("span",null,_(e.work_file)+"%",1)],2)]),s("td",null,[e.rec_status=="success"?(c(),i("span",ut,"ສຳເລັດ")):(c(),i("span",pt,"ດຳເນີນການ"))]),s("td",null,_(e.user_name),1),r.store.get_permissions.includes("DOC_ACC_EDIT")||r.store.get_permissions.includes("DOC_ACC_DEL")||JSON.parse(r.store.get_user).user_type=="admin"?(c(),i("td",mt,[s("div",Dt,[ft,s("div",gt,[r.store.get_permissions.includes("DOC_ACC_EDIT")||JSON.parse(r.store.get_user).user_type=="admin"?(c(),i("a",{key:0,class:"dropdown-item",href:"javascript:void(0);",onClick:f=>a.EditDocWork(e.id)},[yt,D(" ແກ້ໄຂ")],8,bt)):h("",!0),r.store.get_permissions.includes("DOC_ACC_DEL")||JSON.parse(r.store.get_user).user_type=="admin"?(c(),i("a",{key:1,class:"dropdown-item",href:"javascript:void(0);",onClick:f=>a.DelDocWork(e.id)},[wt,D(" ລຶບ")],8,kt)):h("",!0)])])])):h("",!0)]))),128))])):(c(),i("tbody",Ct,xt))]),k(v,{pagination:d.TranDocData,onPaginate:t[10]||(t[10]=e=>a.GetDocWork(e)),offset:4},null,8,["pagination"])])])]),s("div",Ft,[s("div",St,[s("div",Tt,[s("div",Lt,[s("button",Gt,null,512)]),s("div",Et,[s("div",Ut,[s("div",Wt,[s("div",null,[d.TranDocForm.customer_id?(c(),i("div",Rt,[s("span",null,"ຊື່: "+_(d.TranDocForm.customer_name),1),Vt,s("span",null,"ທີ່ຢູ່: "+_(d.TranDocForm.customer_address),1),jt,s("span",null,"ເບີໂທ: "+_(d.TranDocForm.customer_tel),1)])):(c(),i("div",Ot," ລູກຄ້າທົວໄປ "))]),s("div",null,[s("div",At,[s("div",It,[s("button",{type:"button",class:"btn btn-icon rounded-pill btn-primary","data-bs-toggle":"dropdown","aria-expanded":"false",onClick:t[11]||(t[11]=e=>a.Csearch())},Nt),s("div",Mt,[s("div",Bt,[u(s("input",{type:"text",class:"form-control rounded-pill",placeholder:"ຄົ້ນຫາ...","onUpdate:modelValue":t[12]||(t[12]=e=>d.SearchCus=e),onKeyup:t[13]||(t[13]=y(e=>a.GetCus(),["enter"])),ref:"search_cus"},null,544),[[b,d.SearchCus]])]),(c(!0),i(p,null,m(d.CustomerData,e=>(c(),i("a",{key:e.id,onClick:f=>a.addCus(e.id,e.name,e.last_name,e.gender,e.tel,e.address),class:"dropdown-item align-middle d-flex align-items-center justify-content-between cursor-pointer"},[s("span",null,[e.gender=="female"?(c(),i("span",Yt,"ນ")):h("",!0),D(" "+_(e.name)+" "+_(e.last_name),1)]),Kt],8,Jt))),128))])])])])]),zt]),s("div",qt,[s("div",Ht,[s("div",Qt,[Xt,u(s("select",{id:"doctype","onUpdate:modelValue":t[14]||(t[14]=e=>d.Dcat=e),onChange:t[15]||(t[15]=e=>a.ChDocCat()),class:"form-select"},[(c(!0),i(p,null,m(d.DocCatData,e=>(c(),i("option",{key:e.id,value:e.id},_(e.name),9,Zt))),128))],544),[[g,d.Dcat]])]),s("div",$t,[ts,o.loading_table?(c(),i("div",ss,os)):h("",!0)]),s("div",is,[s("ol",cs,[(c(!0),i(p,null,m(d.DocData,(e,f)=>(c(),i("li",{key:e.id,onClick:Fs=>a.Shdoc(e.id),class:"list-group-item d-flex justify-content-between align-items-center cursor-pointer"},[s("span",null,_(f+1)+". "+_(e.doc_name),1),D(),d.listDoc==e.id?(c(),i("i",ds)):h("",!0)],8,ns))),128))])])]),s("div",as,[o.FormType?(c(),i("label",rs,"ລາຄາບໍລິການ: ")):h("",!0),o.FormType?(c(),i("div",ls,[k(x,{options:o.options,modelValue:d.TranDocForm.price,"onUpdate:modelValue":t[16]||(t[16]=e=>d.TranDocForm.price=e),class:"form-control text-end",placeholder:"...."},null,8,["options","modelValue"]),_s])):h("",!0),s("div",hs,[us,u(s("textarea",{name:"",id:"nitice","onUpdate:modelValue":t[17]||(t[17]=e=>d.notices=e),class:"form-control",rows:"5"},null,512),[[b,d.notices]])]),s("div",ps,[ms,Ds,s("img",{src:d.upcp_pre,class:"rounded exp-img cursor-pointer",onClick:t[18]||(t[18]=e=>o.$refs.doc_copy.click())},null,8,fs),s("input",{type:"file",ref:"doc_copy",onChange:t[19]||(t[19]=(...e)=>a.onSelectDocCopy&&a.onSelectDocCopy(...e)),style:{display:"none"},class:"form-control",placeholder:"...."},null,544)])])]),s("div",gs,[s("button",{type:"button",class:"btn btn-primary me-2",onClick:t[20]||(t[20]=e=>a.SaveDocWork()),disabled:a.check_bt},[o.loading_post?(c(),i("div",ks,Cs)):(c(),i("span",ys,"ບັນທຶກ"))],8,bs),vs])])])])])],64)}const Ls=T(W,[["render",xs],["__scopeId","data-v-eac75c0c"]]);export{Ls as default};
