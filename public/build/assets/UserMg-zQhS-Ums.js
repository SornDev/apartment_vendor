import{_ as w,u as k,m as F,r as x,o as i,c as n,b as s,d as m,w as a,g as f,v as _,l as S,F as g,h as b,e as C,n as v,i as u,t as p,p as D,j as E}from"./app-kNdbHso9.js";const V={name:"DmsUserMg",setup(){return{store:k()}},mixins:[F],data(){return{url:window.location.origin,user_img_pre:window.location.origin+"/assets/img/no-img.jpeg",UserData:{data:[]},RolesData:[],UserForm:{name:"",last_name:"",gender:"male",staff_type:"user",user_name:"",password:"",image:"",tel:"",address:"",roles:"",status:"active"}}},computed:{check_bt(){return this.UserForm.name==""||this.UserForm.last_name==""||this.UserForm.tel==""||this.UserForm.address==""||this.UserForm.staff_type=="user"&&this.UserForm.user_name==""||this.UserForm.staff_type=="user"&&this.UserForm.password==""?!0:!!this.loading_post}},mounted(){},methods:{ChangeSort(){this.Sort=="asc"?this.Sort="desc":this.Sort="asc",this.GetUser()},rmimg(){this.UserForm.image="",this.user_img_pre=this.url+"/assets/img/no-img.jpeg"},onSelectImage(r){var e=r.target.files[0];if(e){this.UserForm.image=e;var h=new FileReader;h.onloadend=()=>{e.type.includes("image")?this.user_img_pre=h.result:e.type.includes("word")?this.user_img_pre=this.url+"/assets/img/word.png":e.type.includes("pdf")?this.user_img_pre=this.url+"/assets/img/pdf.png":this.user_img_pre=this.url+"/assets/img/document.png"},h.readAsDataURL(e)}},AddUser(){this.FormType=!0,this.UserForm={name:"",last_name:"",gender:"male",staff_type:"user",user_name:"",password:"",image:"",tel:"",address:"",roles:"",status:"active"};var r=new bootstrap.Modal(document.getElementById("user-form"),{keyboard:!1});r.show()},SaveUser(){this.FormType?this.AddData("user/add",this.UserForm,r=>{r.success&&(this.$refs.close_use_form.click(),this.GetUser())}):this.UpdateData("user/update/"+this.EditID,this.UserForm,r=>{r.success&&(this.$refs.close_use_form.click(),this.GetUser())})},EditUser(r){this.FormType=!1,this.EditData("user/edit",r,e=>{if(e.success){this.EditID=r,this.UserForm=e.user,e.user.image?this.user_img_pre=this.url+"/assets/img/"+e.user.image:this.user_img_pre=this.url+"/assets/img/no-img.jpeg";var h=new bootstrap.Modal(document.getElementById("user-form"),{keyboard:!1});h.show()}})},DeleteUser(r){this.DeleteData("user/delete",r,e=>{e.success&&this.GetUser()})},GetUser(r){this.GetData(`user/get?page=${r}&perpage=${this.PerPage}&sort=${this.Sort}&search=${this.Search}`,e=>{this.UserData=e.user,this.RolesData=e.roles})}},created(){this.GetUser()},watch:{Search:function(r){r==""&&this.GetUser()}}},o=r=>(D("data-v-6d35a9b5"),r=r(),E(),r),I={class:"card"},R={class:"card-header d-flex"},j=o(()=>s("h5",{class:"mb-0"},"ຈັດການຜູ້ໃຊ້",-1)),A={key:0,class:"spinner-grow spinner-grow-sm text-warning ms-2",role:"status"},G=o(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),T=[G],L={class:"card-body"},N={class:"table-responsive text-nowrap"},M={class:"d-flex justify-content-between mb-2"},P={class:"d-flex justify-content-between align-items-center"},B={key:0,class:"bx bx-sort-up fs-4 me-2"},J={key:1,class:"bx bx-sort-down fs-4 me-2"},O=o(()=>s("option",{value:"10"},"10",-1)),K=o(()=>s("option",{value:"20"},"20",-1)),q=o(()=>s("option",{value:"30"},"30",-1)),z=[O,K,q],H={class:"d-flex"},Q={class:"table table-bordered shadow-sm"},W={class:"table-info"},X=o(()=>s("th",{class:"fs-6 fw-bold",width:"40"},null,-1)),Y=o(()=>s("th",{class:"fs-6 fw-bold"},"ຊື່ ແລະ ນາມສະກຸນ",-1)),Z=o(()=>s("th",{class:"fs-6 fw-bold"},"ທີ່ຢູ່ / ຕິດຕໍ່",-1)),$=o(()=>s("th",{class:"fs-6 fw-bold"},"ຊື່ຜູ້ໃຊ້",-1)),ss=o(()=>s("th",{class:"fs-6 fw-bold",width:"110"},"ສະຖານະ",-1)),es={key:0,class:"fs-6 fw-bold",width:"100"},ts={key:0},os={key:0},rs=o(()=>s("td",{colspan:"6",class:"text-center"},[s("div",{class:"spinner-border text-warning",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")])],-1)),ls=[rs],is=["src"],ns=["src"],as={key:0},ds=o(()=>s("br",null,null,-1)),cs={class:"text-center"},ms={key:0,class:"badge bg-label-success"},_s={key:1,class:"badge bg-label-danger"},us={key:0,class:"text-center"},hs={class:"dropdown"},ps=o(()=>s("button",{type:"button",class:"btn p-0 dropdown-toggle hide-arrow","data-bs-toggle":"dropdown"},[s("i",{class:"bx bx-dots-vertical-rounded"})],-1)),fs={class:"dropdown-menu"},gs=["onClick"],bs=o(()=>s("i",{class:"bx bx-edit-alt me-1"},null,-1)),vs=["onClick"],Us=o(()=>s("i",{class:"bx bx-trash me-1"},null,-1)),ys={key:1},ws=o(()=>s("tr",null,[s("td",{colspan:"6",class:"text-center"},[s("i",{class:"bx bxs-data me-1"}),u(" ບໍ່ມີຂໍ້ມູນ ")])],-1)),ks=[ws],Fs={class:"modal modal-top modal-md fade","data-bs-backdrop":"static",id:"user-form",tabindex:"-1",style:{display:"none"},"aria-hidden":"true"},xs={class:"modal-dialog"},Ss={class:"modal-content"},Cs={class:"modal-header"},Ds={type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",ref:"close_use_form"},Es={class:"modal-body pt-0"},Vs={class:"row"},Is={class:"col-12 mb-3"},Rs={class:"d-flex justify-content-center"},js={class:"position-relative"},As=["src"],Gs={class:"position-absolute top-0 end-0"},Ts=o(()=>s("i",{class:"bx bx-x fs-4"},null,-1)),Ls=[Ts],Ns={class:"row mb-2"},Ms={class:"col-md-6"},Ps=o(()=>s("label",{for:"f-name",class:"fs-6"},"ຊື່:",-1)),Bs={class:"col-md-6"},Js=o(()=>s("label",{for:"f-lastname",class:"fs-6"},"ນາມສະກຸນ:",-1)),Os={class:"row mb-2"},Ks={class:"col-md-6"},qs=o(()=>s("label",{for:"",class:"fs-6 me-2 mb-2"},"ເພດ:",-1)),zs={class:"d-flex align-items-center"},Hs={class:"form-check me-2"},Qs=o(()=>s("label",{class:"form-check-label",for:"male"}," ຊາຍ ",-1)),Ws={class:"form-check me-2"},Xs=o(()=>s("label",{class:"form-check-label",for:"female"}," ຍິງ ",-1)),Ys={class:"col-md-6"},Zs=o(()=>s("label",{for:"st",class:"form-label fs-6"},"ປະເພດຜູ້ໃຊ້:",-1)),$s=o(()=>s("option",{value:"staff"},"ພະນັກງານ",-1)),se=o(()=>s("option",{value:"user"},"ພະນັກງານ ແລະ ຜູ້ໃຊ້ງານ",-1)),ee=[$s,se],te={key:0,class:"row mb-2"},oe={class:"col-md-6"},re=o(()=>s("label",{for:"user-name",class:"form-label fs-6"},"ຊື່ຜູ້ໃຊ້:",-1)),le={class:"col-md-6"},ie=o(()=>s("label",{for:"user-pass",class:"form-label fs-6"},"ລະຫັດຜ່ານ:",-1)),ne={class:"row mb-2"},ae={class:"col-md-6"},de=o(()=>s("label",{for:"tel",class:"form-label fs-6"},"ເບີໂທ:",-1)),ce={class:"col-md-6"},me=o(()=>s("label",{for:"address",class:"form-label fs-6"},"ທີ່ຢູ່:",-1)),_e={class:"row mb-2"},ue={class:"col-md-6"},he=o(()=>s("label",{for:"rolse",class:"form-label fs-6"},"ສິດຜູ້ໃຊ້:",-1)),pe=["value"],fe={class:"col-md-6"},ge=o(()=>s("label",{for:"status",class:"form-label fs-6"},"ສະຖານະ:",-1)),be=o(()=>s("option",{value:"active"},"ໃຊ້ງານຢູ່",-1)),ve=o(()=>s("option",{value:"disable"},"ປິດ",-1)),Ue=[be,ve],ye={class:"d-flex justify-content-end mt-4"},we=["disabled"],ke={key:0},Fe={key:1,class:"spinner-border text-warning",role:"status"},xe=o(()=>s("span",{class:"visually-hidden"},"Loading...",-1)),Se=[xe],Ce=o(()=>s("button",{type:"button",class:"btn btn-label-secondary","data-bs-dismiss":"modal"},"ຍົກເລີກ",-1));function De(r,e,h,d,l,c){const U=x("pagination");return i(),n(g,null,[s("div",I,[s("div",R,[j,r.loading_table?(i(),n("div",A,T)):m("",!0)]),s("div",L,[s("div",N,[s("div",M,[s("div",P,[s("div",{class:"cursor-pointer",onClick:e[0]||(e[0]=t=>c.ChangeSort())},[r.Sort=="asc"?(i(),n("i",B)):(i(),n("i",J))]),a(s("select",{class:"form-select me-2","onUpdate:modelValue":e[1]||(e[1]=t=>r.PerPage=t),onChange:e[2]||(e[2]=t=>c.GetUser())},z,544),[[f,r.PerPage]])]),s("div",H,[a(s("input",{type:"text",class:"form-control me-2","onUpdate:modelValue":e[3]||(e[3]=t=>r.Search=t),onKeyup:e[4]||(e[4]=S(t=>c.GetUser(),["enter"])),placeholder:"ຄົ້ນຫາ..."},null,544),[[_,r.Search]]),d.store.get_permissions.includes("USER_ACC_EDIT")||JSON.parse(d.store.get_user).user_type=="admin"?(i(),n("button",{key:0,class:"btn btn-primary",onClick:e[5]||(e[5]=t=>c.AddUser())},"ເພີ່ມໃໝ່")):m("",!0)])]),s("table",Q,[s("thead",null,[s("tr",W,[X,Y,Z,$,ss,d.store.get_permissions.includes("USER_ACC_EDIT")||d.store.get_permissions.includes("USER_ACC_DEL")||JSON.parse(d.store.get_user).user_type=="admin"?(i(),n("th",es,"ຈັດການ")):m("",!0)])]),l.UserData.data.length>0?(i(),n("tbody",ts,[r.loading_table?(i(),n("tr",os,ls)):(i(!0),n(g,{key:1},b(l.UserData.data,t=>(i(),n("tr",{key:t.id},[s("td",null,[t.image?(i(),n("img",{key:0,src:l.url+"/assets/img/"+t.image,class:"rounded-circle avatar imc"},null,8,is)):(i(),n("img",{key:1,src:l.url+"/assets/img/no-img.jpeg",class:"rounded-circle avatar imc"},null,8,ns))]),s("td",null,[u(" ທ່ານ "),t.gender=="female"?(i(),n("span",as,"ນ")):m("",!0),u(" "+p(t.name)+" "+p(t.last_name),1)]),s("td",null,[u(p(t.address)+" ",1),ds,u(" ເບີໂທ: "+p(t.tel),1)]),s("td",null,p(t.user_name),1),s("td",cs,[t.status=="active"?(i(),n("span",ms,"ໃຊ້ຢູ່")):(i(),n("span",_s,"ປິດ"))]),d.store.get_permissions.includes("USER_ACC_EDIT")||d.store.get_permissions.includes("USER_ACC_DEL")?(i(),n("td",us,[s("div",hs,[ps,s("div",fs,[d.store.get_permissions.includes("USER_ACC_EDIT")||JSON.parse(d.store.get_user).user_type=="admin"?(i(),n("a",{key:0,class:"dropdown-item",href:"javascript:void(0);",onClick:y=>c.EditUser(t.id)},[bs,u(" ແກ້ໄຂ")],8,gs)):m("",!0),d.store.get_permissions.includes("USER_ACC_DEL")||JSON.parse(d.store.get_user).user_type=="admin"?(i(),n("a",{key:1,class:"dropdown-item",href:"javascript:void(0);",onClick:y=>c.DeleteUser(t.id)},[Us,u(" ລຶບ")],8,vs)):m("",!0)])])])):m("",!0)]))),128))])):(i(),n("tbody",ys,ks))]),C(U,{pagination:l.UserData,onPaginate:e[6]||(e[6]=t=>c.GetUser(t)),offset:4},null,8,["pagination"])])])]),s("div",Fs,[s("div",xs,[s("form",Ss,[s("div",Cs,[s("button",Ds,null,512)]),s("div",Es,[s("div",Vs,[s("div",Is,[s("div",Rs,[s("div",js,[s("img",{src:l.user_img_pre,onClick:e[7]||(e[7]=t=>r.$refs.user_img.click()),class:"rounded-circle av-p cursor-pointer",alt:"",srcset:""},null,8,As),s("div",Gs,[l.UserForm.image?(i(),n("label",{key:0,class:"btn btn-icon btn-danger rounded-circle",onClick:e[8]||(e[8]=t=>c.rmimg()),style:{width:"40px",height:"40px"}},Ls)):m("",!0),s("input",{type:"file",ref:"user_img",onChange:e[9]||(e[9]=t=>c.onSelectImage(t)),class:"d-none"},null,544)])])])])]),s("div",Ns,[s("div",Ms,[Ps,a(s("input",{class:"form-control",type:"text","onUpdate:modelValue":e[10]||(e[10]=t=>l.UserForm.name=t),id:"f-name",placeholder:"..."},null,512),[[_,l.UserForm.name]])]),s("div",Bs,[Js,a(s("input",{class:"form-control",type:"text","onUpdate:modelValue":e[11]||(e[11]=t=>l.UserForm.last_name=t),id:"f-lastname",placeholder:"..."},null,512),[[_,l.UserForm.last_name]])])]),s("div",Os,[s("div",Ks,[qs,s("div",zs,[s("div",Hs,[a(s("input",{name:"gender","onUpdate:modelValue":e[12]||(e[12]=t=>l.UserForm.gender=t),class:"form-check-input",type:"radio",value:"male",id:"male"},null,512),[[v,l.UserForm.gender]]),Qs]),s("div",Ws,[a(s("input",{name:"gender","onUpdate:modelValue":e[13]||(e[13]=t=>l.UserForm.gender=t),class:"form-check-input",type:"radio",value:"female",id:"female"},null,512),[[v,l.UserForm.gender]]),Xs])])]),s("div",Ys,[Zs,a(s("select",{id:"st","onUpdate:modelValue":e[14]||(e[14]=t=>l.UserForm.staff_type=t),class:"form-select"},ee,512),[[f,l.UserForm.staff_type]])])]),l.UserForm.staff_type=="user"?(i(),n("div",te,[s("div",oe,[re,a(s("input",{type:"text","onUpdate:modelValue":e[15]||(e[15]=t=>l.UserForm.user_name=t),id:"user-name",class:"form-control",placeholder:"..."},null,512),[[_,l.UserForm.user_name]])]),s("div",le,[ie,a(s("input",{type:"password","onUpdate:modelValue":e[16]||(e[16]=t=>l.UserForm.password=t),id:"user-pass",class:"form-control",placeholder:"..."},null,512),[[_,l.UserForm.password]])])])):m("",!0),s("div",ne,[s("div",ae,[de,a(s("input",{type:"text","onUpdate:modelValue":e[17]||(e[17]=t=>l.UserForm.tel=t),id:"tel",class:"form-control",placeholder:"..."},null,512),[[_,l.UserForm.tel]])]),s("div",ce,[me,a(s("input",{type:"text","onUpdate:modelValue":e[18]||(e[18]=t=>l.UserForm.address=t),id:"address",class:"form-control",placeholder:"..."},null,512),[[_,l.UserForm.address]])])]),s("div",_e,[s("div",ue,[he,a(s("select",{id:"st","onUpdate:modelValue":e[19]||(e[19]=t=>l.UserForm.roles=t),class:"form-select"},[(i(!0),n(g,null,b(l.RolesData,t=>(i(),n("option",{value:t.id,key:t.id},p(t.role_name),9,pe))),128))],512),[[f,l.UserForm.roles]])]),s("div",fe,[ge,a(s("select",{id:"st","onUpdate:modelValue":e[20]||(e[20]=t=>l.UserForm.status=t),class:"form-select"},Ue,512),[[f,l.UserForm.status]])])]),s("div",ye,[s("button",{type:"button",class:"btn btn-primary me-2",disabled:c.check_bt,onClick:e[21]||(e[21]=t=>c.SaveUser())},[r.loading_post?(i(),n("div",Fe,Se)):(i(),n("span",ke,"ບັນທຶກ"))],8,we),Ce])])])])])],64)}const Ve=w(V,[["render",De],["__scopeId","data-v-6d35a9b5"]]);export{Ve as default};
